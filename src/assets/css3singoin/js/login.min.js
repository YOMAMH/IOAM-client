$(function(){function e(){Cookies.get("ty_cmdb")?$.ajax({url:login_env_config().env+"/user/loginAuth",type:"GET",headers:{Authorization:Cookies.get("ty_cmdb")+":"+Cookies.get("ty_cmdb_auth")},timeout:3e3,success:function(e){if(200===e.status){$(".banner").addClass("showBanner"),$(".nav").addClass("showNav"),$(".detail").addClass("showDetailView");var i=Cookies.get("ty_cmdb_user"),s=Cookies.get("ty_cmdb_auth");$("#user").text(i),$(".loginView").hide(),$(".contain").show();var t=s.split(","),a="0";t.forEach(function(e){a<e&&(a=e)});$("#orderNav li").length;if("1.1"!==a&&s)if("1.2"===a||"1.3"===a){$("#authNav").remove(),$("#apmInfo").remove(),$("#ucloudInfo").remove(),$("#aliInfo").remove();for(var n=0;n<3;n++)$("#orderNav li:eq(4)").remove();$(".navItemTitle").eq(0).next().slideDown().parent().siblings().children().next().slideUp(),$(".navItemTitle").eq(0).next().children().eq(0).children().addClass("actives").parent().siblings().children().removeClass("actives")}else"2"===a&&($("#authNav").remove(),$("#orderNav li:eq(6)").remove());else{$("#authNav").remove(),$("#apmInfo").remove(),$("#ucloudInfo").remove(),$("#aliInfo").remove();for(var n=0;n<4;n++)$("#orderNav li:eq(3)").remove()}}else this.error()},error:function(){$("#user").text(""),$(".contain").hide(),$(".loginView").show(),$(".banner").removeClass("showBanner"),$(".nav").removeClass("showNav"),$(".detail").removeClass("showDetailView"),Cookies.remove("ty_cmdb"),Cookies.remove("ty_cmdb_user"),Cookies.remove("ty_cmdb_auth")}}):($("#user").text(""),$(".contain").hide(),$(".loginView").show(),$(".banner").removeClass("showBanner"),$(".nav").removeClass("showNav"),$(".detail").removeClass("showDetailView"),Cookies.remove("ty_cmdb"),Cookies.remove("ty_cmdb_user"),Cookies.remove("ty_cmdb_auth"))}function i(e,i){return btoa(e+":"+i)}function s(e){return Math.floor(Math.random()*e+1)}function t(){var e=$(document).height();$(".lodingView").css("paddingTop",e/2-50);var i=["rotating-plane","double-bounce","wave","wandering-cubes","pulse","chasing-dots","three-bounce","circle","cube-grid","run-ball","fading-circle"],t="rotating-plane";$("[class^=mop-load]").each(function(e){var s=$(this).html().trim(),t=$(this).attr("class"),a=t.split("mop-load-");if(!(a.length<2)){var n='<div class="mop-load-div">';if(1*a[1].trim()<i.length)n+='<div class="mop-css-'+a[1].trim()+'">';else{if("x"!=a[1].trim())return;n+='<div class="mop-css-x">'}""==s?s="正在登出……":$(this).html(s),n+='</div><div class="mop-load-text" >'+s+"</div></div>",$(this).html(n),$(this).css("text-align","center")}}),$("[class^=mop-css]").each(function(e){var a=$(this).attr("class"),n=a.split("mop-css-");if("mop-css"==n&&$(this).addClass(t),"x"==n[1].trim()){var c=s(i.length-1);$(this).addClass(i[c])}else{if(!(1*n[1]<i.length))return;$(this).addClass(i[n[1]])}}),$(".double-bounce").each(function(e){var i='<div class="double-bounce1"></div><div class="double-bounce2"></div>';$(this).append(i)}),$(".wave").each(function(e){var i='<div class = "rect1" ></div><div class = "rect2" ></div><div class = "rect3" ></div><div class = "rect4" ></div><div class = "rect5" ></div>';$(this).append(i)}),$(".wandering-cubes").each(function(e){var i='<div class="cube1"></div><div class="cube2"></div>';$(this).append(i)}),$(".chasing-dots").each(function(e){var i='<div class="dot1"></div><div class="dot2"></div>';$(this).append(i)}),$(".three-bounce").each(function(e){var i='<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div>';$(this).append(i)}),$(".circle").each(function(e){var i='<div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div>';i+='<div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div>',i+='<div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div>',$(this).append(i)}),$(".cube-grid").each(function(e){var i='<div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div>';$(this).append(i)}),$(".run-ball").each(function(e){var i='<span class="sk-inner-circle"></span>';$(this).append(i)}),$(".fading-circle").each(function(e){var i='<div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div>';i+='<div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div>',$(this).append(i)})}function a(e){$("#user").text(e.result.content),Cookies.set("ty_cmdb",e.result.hashKey,{expires:1}),Cookies.set("ty_cmdb_auth",e.result.auth,{expires:1}),Cookies.set("ty_cmdb_user",e.result.content,{expires:1});var i=($("#orderNav li").length,e.result.auth.split(",")),s="0";if(i.forEach(function(e){s<e&&(s=e)}),"1.1"!==s&&e.result.auth)if("1.2"===s||"1.3"===s){$("#authNav").remove(),$("#apmInfo").remove(),$("#ucloudInfo").remove(),$("#aliInfo").remove(),$("#orderInfo .navItemTitle").next().slideToggle(),$("#orderInfo .navItemTitle").next().children().eq(0).children().addClass("actives");for(var t=0;t<3;t++)$("#orderNav li:eq(4)").remove();location.href="/#/workOrder/handedleOrder"}else"2"===s?($("#authNav").remove(),$("#orderNav li:eq(6)").remove(),location.href="/#/apm/app",$(".navItemTitle").eq(0).next().slideDown().parent().siblings().children().next().slideUp(),$(".navItemTitle").eq(0).next().children().eq(0).children().addClass("actives").parent().siblings().children().removeClass("actives")):e.result.auth&&"3"===e.result.auth&&(location.href="/#/apm/app",$(".navItemTitle").eq(0).next().slideDown().parent().siblings().children().next().slideUp(),$(".navItemTitle").eq(0).next().children().eq(0).children().addClass("actives").parent().siblings().children().removeClass("actives"));else{$("#authNav").remove(),$("#apmInfo").remove(),$("#ucloudInfo").remove(),$("#aliInfo").remove(),$("#orderInfo .navItemTitle").next().slideToggle(),$("#orderInfo .navItemTitle").next().children().eq(0).children().addClass("actives");for(var t=0;t<4;t++)$("#orderNav li:eq(3)").remove();location.href="/#/workOrder/handedleOrder"}setTimeout(function(){$(".success").find("span").text("认证成功").css({fontSize:"25px",color:"#fff"}),$(".success").find("p").text("欢迎回来").css("color","white"),$(".success").fadeIn()},2200),setTimeout(function(){$(".success").fadeOut(),$(".loginView").hide(),$(".contain").show(),$(".banner").addClass("showBanner"),$(".nav").addClass("showNav"),$(".detail").addClass("showDetailView")},2800)}e(),t(),$('input[type="submit"]').click(function(){var e=$.trim($("#userName").val()),s=$.trim($("#password").val());$.ajax({url:login_env_config().env+"/user/login",type:"post",timeout:3e3,data:{userName:e,pwd:s,base64:i(e,"ty_cmdb")},beforeSend:function(){return e&&s?($(".login_fields__msg > span").text("").css("color",""),$(".login").addClass("test"),setTimeout(function(){$(".login").addClass("testtwo"),$(".login_fields__submit>input").val("登录中...")},300),setTimeout(function(){$(".authent").show().animate({right:-320},{easing:"easeOutQuint",duration:600,queue:!1}),$(".authent").animate({opacity:1},{duration:200,queue:!1}).addClass("visible")},500),setTimeout(function(){$(".authent").show().animate({right:90},{easing:"easeOutQuint",duration:600,queue:!1}),$(".authent").animate({opacity:0},{duration:200,queue:!1}).addClass("visible"),$(".login").removeClass("testtwo")},1500),void setTimeout(function(){$(".login").removeClass("test"),$(".login div").fadeOut(123),$("#userName").val(""),$("#password").val("")},1800)):($(".login_fields__msg > span").text("用户名和密码不能为空").css("color","red"),!1)},success:function(e){200==e.status?a(e):($("#user").text(""),this.error())},error:function(e){setTimeout(function(){$(".success").find("span").text("认证失败").css("fontSize","25px"),$(".success").find("p").text("请重新登陆").css("color","white"),$(".success").fadeIn()},2200),setTimeout(function(){$(".success").fadeOut(),$(".login_fields__submit>input").val("登录"),$(".login div").fadeIn(123),$(".success").find("h2").text(""),$(".success").find("p").text(""),$(".authent").fadeOut(),$(".success").find("span").text(""),$(".success").find("p").text("")},2800)}})}),$("body").on("keydown",function(e){var i=Cookies.get("ty_cmdb_user"),s=Cookies.get("ty_cmdb_auth");i||s||13===e.keyCode&&$('input[type="submit"]').click()}),$('input[type="text"],input[type="password"]').focus(function(){$(this).prev().animate({opacity:"1"},200)}),$('input[type="text"],input[type="password"]').blur(function(){$(this).prev().animate({opacity:".5"},200)}),$('input[type="text"],input[type="password"]').keyup(function(){""==!$(this).val()?$(this).next().animate({opacity:"1",right:"30"},200):$(this).next().animate({opacity:"0",right:"20"},200)}),$(".headIcon img").on("mouseenter",function(){$(".mySetting").fadeIn()}),$(".banner .mySetting").on("mouseleave",function(){$(".mySetting").fadeOut(500)}),$(".content").on("mouseenter",function(){$(".mySetting").fadeOut(500)}),$(".mySetting div:eq(1) a").on("click",function(){confirm("确定退出吗？")&&($(".contain").hide(),$(".loginView").hide(),Cookies.remove("ty_cmdb"),Cookies.remove("ty_cmdb_user"),Cookies.remove("ty_cmdb_auth"),$(".lodingView").show(),setTimeout(function(){location.href="/#/apm",location.reload(function(){$(".lodingView").hide(),$(".loginView").show(),$(".banner").removeClass("showBanner"),$(".nav").removeClass("showNav"),$(".detail").removeClass("showDetailView")})},400))})});